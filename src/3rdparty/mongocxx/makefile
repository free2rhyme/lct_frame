

MONGOCXX_LIBRARY_PATH  := $(CURDIR)/lib
SYMBOLIC_FLAGS         := -r -s

LIB_BSONCXX_SO_FILE    := libbsoncxx.so.3.1.1
LIB_BSONCXX_SO_NOABI   := libbsoncxx.so._noabi
LIB_BSONCXX_SO         := libbsoncxx.so

LIB_MONGOCXX_SO_FILE   := libmongocxx.so.3.1.1
LIB_MONGOCXX_SO_NOABI  := libmongocxx.so._noabi
LIB_MONGOCXX_SO        := libmongocxx.so

LIB_BSON_1_0_SO_FILE   := libbson-1.0.so.0.0.0
LIB_BSON_1_0_SO_0      := libbson-1.0.so.0
LIB_BSON_1_0_SO        := libbson-1.0.so
LIB_BSON_SO            := libbson.so

LIB_MONGOC_1_0_SO_FILE     := libmongoc-1.0.so.0.0.0
LIB_MONGOC_1_0_SO_0        := libmongoc-1.0.so.0
LIB_MONGOC_1_0_SO          := libmongoc-1.0.so
LIB_MONGOC_SO              := libmongoc.so

FIXED_LIB_BSONCXX_SO_FILE  := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSONCXX_SO_FILE)
FIXED_LIB_BSONCXX_SO_NOABI := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSONCXX_SO_NOABI)
FIXED_LIB_BSONCXX_SO       := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSONCXX_SO)

FIXED_LIB_MONGOCXX_SO_FILE := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOCXX_SO_FILE)
FIXED_LIB_MONGOCXX_SO_NOABI:= $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOCXX_SO_NOABI)
FIXED_LIB_MONGOCXX_SO      := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOCXX_SO)

FIXED_LIB_BSON_1_0_SO_FILE     := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSON_1_0_SO_FILE)
FIXED_LIB_BSON_1_0_SO_0        := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSON_1_0_SO_0)
FIXED_LIB_BSON_1_0_SO          := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSON_1_0_SO)
FIXED_LIB_BSON_SO              := $(MONGOCXX_LIBRARY_PATH)/$(LIB_BSON_SO)

FIXED_LIB_MONGOC_1_0_SO_FILE   := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOC_1_0_SO_FILE)
FIXED_LIB_MONGOC_1_0_SO_0      := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOC_1_0_SO_0)
FIXED_LIB_MONGOC_1_0_SO        := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOC_1_0_SO)
FIXED_LIB_MONGOC_SO            := $(MONGOCXX_LIBRARY_PATH)/$(LIB_MONGOC_SO)

all debug release build:
	@echo "Start building $@"

ifneq ($(FIXED_LIB_BSONCXX_SO_NOABI), $(wildcard $(FIXED_LIB_BSONCXX_SO_NOABI)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_BSONCXX_SO_FILE) $(FIXED_LIB_BSONCXX_SO_NOABI)
endif

ifneq ($(FIXED_LIB_BSONCXX_SO), $(wildcard $(FIXED_LIB_BSONCXX_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_BSONCXX_SO_FILE) $(FIXED_LIB_BSONCXX_SO)
endif

ifneq ($(FIXED_LIB_MONGOCXX_SO_NOABI), $(wildcard $(FIXED_LIB_MONGOCXX_SO_NOABI)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_MONGOCXX_SO_FILE) $(FIXED_LIB_MONGOCXX_SO_NOABI)
endif

ifneq ($(FIXED_LIB_MONGOCXX_SO), $(wildcard $(FIXED_LIB_MONGOCXX_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_MONGOCXX_SO_FILE) $(FIXED_LIB_MONGOCXX_SO)
endif

ifneq ($(FIXED_LIB_BSON_1_0_SO_0), $(wildcard $(FIXED_LIB_BSON_1_0_SO_0)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_BSON_1_0_SO_FILE) $(FIXED_LIB_BSON_1_0_SO_0)
endif

ifneq ($(FIXED_LIB_BSON_1_0_SO), $(wildcard $(FIXED_LIB_BSON_1_0_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_BSON_1_0_SO_FILE) $(FIXED_LIB_BSON_1_0_SO)
endif

ifneq ($(FIXED_LIB_BSON_SO), $(wildcard $(FIXED_LIB_BSON_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_BSON_1_0_SO_FILE) $(FIXED_LIB_BSON_SO)
endif

ifneq ($(FIXED_LIB_MONGOC_1_0_SO_0), $(wildcard $(FIXED_LIB_MONGOC_1_0_SO_0)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_MONGOC_1_0_SO_FILE) $(FIXED_LIB_MONGOC_1_0_SO_0)
endif

ifneq ($(FIXED_LIB_MONGOC_1_0_SO), $(wildcard $(FIXED_LIB_MONGOC_1_0_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_MONGOC_1_0_SO_FILE) $(FIXED_LIB_MONGOC_1_0_SO)
endif

ifneq ($(FIXED_LIB_MONGOC_SO), $(wildcard $(FIXED_LIB_MONGOC_SO)))
	ln $(SYMBOLIC_FLAGS) $(FIXED_LIB_MONGOC_1_0_SO_FILE) $(FIXED_LIB_MONGOC_SO)
endif

	@echo "Finished building $@"

clean:
	rm -f $(FIXED_LIB_BSONCXX_SO_NOABI)
	rm -f $(FIXED_LIB_BSONCXX_SO)
	rm -f $(FIXED_LIB_MONGOCXX_SO_NOABI)
	rm -f $(FIXED_LIB_MONGOCXX_SO)
	rm -f $(FIXED_LIB_BSON_1_0_SO_0)
	rm -f $(FIXED_LIB_BSON_1_0_SO)
	rm -f $(FIXED_LIB_BSON_SO)
	rm -f $(FIXED_LIB_MONGOC_1_0_SO_0)
	rm -f $(FIXED_LIB_MONGOC_1_0_SO)
	rm -f $(FIXED_LIB_MONGOC_SO)
	@echo " "

rebuild: build

.PHONY:clean rebuild



